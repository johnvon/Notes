\lecture{19}{18 Feb.\ 11:00}{Fubini-Tonelli's Theorem}
\begin{prev}
	If \(E\in A\otimes B\implies E_{x} \in \mathcal{B} , E^y\in \mathcal{A}\ \forall x\in X, \forall y\in Y\).
	Note that the reverse is not true.
\end{prev}

\section{Fubini-Tonelli Theorem}
We start with a theorem.

\begin{theorem}[Tonelli's theorem for characteristic functions]\label{thm:Tonelli-for-characteristic-functions}
	Given \((X, \mathcal{A} , \mu )\) and \((Y, \mathcal{B} , \nu )\) be \hyperref[def:sigma-finite-measure]{\(\sigma\)-finite} \hyperref[def:measure-space]{measure space}. Suppose \(E\in \mathcal{A} \otimes \mathcal{B} \), then
	\begin{enumerate}[(a)]
		\item\label{thm:Tonelli-for-characteristic-functions-a} \(\alpha (x)\coloneqq \nu (E_x)\colon X\to [0, \infty ]\) is a \hyperref[def:A-measurable-function]{\(\mathcal{A}\)-measurable function};
		\item\label{thm:Tonelli-for-characteristic-functions-b} \(\beta (x)\coloneqq \mu (E^y)\colon Y\to [0, \infty ]\) is a \hyperref[def:A-measurable-function]{\(\mathcal{B}\)-measurable function};
		\item\label{thm:Tonelli-for-characteristic-functions-c} \((\mu \times \nu) (E) = \int_X \nu (E_x)\,\mathrm{d} \mu(x) = \int _Y \mu (E^y)\,\mathrm{d} \nu (y)\).
	\end{enumerate}
\end{theorem}
\begin{proof}
	We prove this in two cases.
	\begin{enumerate}
		\item Assume that \(\mu , \nu \) are \hyperref[def:finite-measure]{finite measures}. Let
		      \[
			      C \coloneqq \left\{E\in \mathcal{A} \otimes \mathcal{B} \mid \text{ Conditions \autoref{thm:Tonelli-for-characteristic-functions-a}, \autoref{thm:Tonelli-for-characteristic-functions-b}, \autoref{thm:Tonelli-for-characteristic-functions-c} hold} \right\}.
		      \]
		      It's enough to prove that \(\left< \mathcal{R}  \right> = \mathcal{A} \otimes \mathcal{B} \subset C\). We further observe that from the \autoref{thm:monotone-class-lemma} and the fact that \(\mathcal{R} \) is an \hyperref[def:algebra]{algebra}, it's also enough to show that
		      \begin{itemize}
			      \item \(\mathcal{R} \subset C\).
			      \item \(C\) is a \hyperref[def:monotone-class]{monotone class}.
		      \end{itemize}
		      From condition \autoref{thm:Tonelli-for-characteristic-functions-a},
		      \[
			      \alpha (x) = \nu \left((A\times B)_x\right) = \begin{dcases}
				      \nu (B), & \text{ if } x\in A ;   \\
				      0,       & \text{ if } x \notin A
			      \end{dcases} = \nu (B)\mathbbm{1}_{A}.
		      \]
		      And from condition \autoref{thm:Tonelli-for-characteristic-functions-b},
		      \[
			      (\mu \times \nu )(A\times B) = \mu (A)\nu (B)
		      \]
		      and
		      \[
			      \int _X \nu ((A\times B)_x)\,\mathrm{d} \mu (x) = \nu (B)\mu (A).
		      \]

		      Let \(E_{n} \in C\), \(E_1\subset E_{2}\subset \dots\). We need to show \(E = \bigcup_{n=1}^{\infty} E_{n} \in C\). We now see that
		      \[
			      \begin{split}
				      E_{x}  = \bigcup_{n=1}^{\infty} (E_{n} )_x, (E_1)_x\subset (E_2)_x\subset \dots
				      \implies \alpha (x) = \nu (E_n)_x \overset{\hyperref[thm:measure-space-continuity-from-below]{!}}{=} \lim_{n \to \infty} \nu ((E_n)_x)\ \forall x\in X.
			      \end{split}
		      \]
		      This implies that \autoref{thm:Tonelli-for-characteristic-functions-a} is proved. For \autoref{thm:Tonelli-for-characteristic-functions-c}, we see that
		      \[
			      \begin{split}
				      (\mu \times \nu )(E)
				       & \overset{\hyperref[thm:measure-space-continuity-from-below]{!}}{=}\lim_{n \to \infty} (\mu \times \nu )(E_{n} )
				      = \lim_{n \to \infty} \int _X \nu ((E_{n})_x) \,\mathrm{d} \mu (x)
				      \overset{\hyperref[thm:MCT]{!}}{=} \int _X \nu (E_{x} )\,\mathrm{d} \mu (x).
			      \end{split}
		      \]

		      Now let \(F_{n} \in C\), \(F_1\supset F_2\supset \dots  \). We need to show that \(F = \bigcap_{n=1}^{\infty} F_{n} \in C\). Instead of using \autoref{thm:MCT}, we now want to use \autoref{thm:DCT}, which is applicable since \(\mu (X), \nu (Y)< \infty \) by assumption.
		\item Assume \(\mu\) and \(\nu \) are \hyperref[def:sigma-finite-measure]{\(\sigma \)-finite measures}. We then have a sequence \(\{X_n \times Y_n\}\) of \hyperref[def:rectangle]{rectangles} of with only finite \hyperref[def:measure]{measure}. Now, just consider if \(E\in \mathcal{A} \otimes \mathcal{B} \), \autoref{thm:Tonelli-for-characteristic-functions-a} applies to \(E \cap (X_{n} \times Y_{n} )\) for each \(n\), with
		      \[
			      X\times Y = \bigcup_{n=1}^{\infty} (X_{n} \times Y_{n} ), \begin{dcases}
				      X_1\subset X_2\subset \dots , & \mu (X_{k} )< \infty   \\
				      Y_1\subset Y_2\subset \dots , & \nu (Y_{k} )< \infty ,
			      \end{dcases}
		      \]
		      we have
		      \[
			      \mu \times \nu (E \cap (X_{n} \times Y_{n} )) = \int \mathbbm{1}_{X_{n} } (x) . \nu (E_{x} \cap Y_{n} )\,\mathrm{d} \nu (x) = \int \mathbbm{1}_{Y_{n} } (y)\mu (E^y \cap X_{n} )\,\mathrm{d} \nu (y).
		      \]
		      By applying \autoref{thm:MCT}, the result follows.
	\end{enumerate}
\end{proof}

\begin{theorem}[Fubini-Tonelli's theorem]\label{thm:Fubini-Tonelli}
	Given two \hyperref[def:finite-measure]{\(\sigma \)-finite} \hyperref[def:measure-space]{measure space} \((X, \mathcal{A} , \mu ), (Y, \mathcal{B} , \nu )\), we have the following.

	\begin{theorem*}[Tonelli's theorem]\label{thm:Tonelli}
		If \(f\colon X\times Y\to [0, \infty ]\) is \hyperref[def:A-measurable-function]{\(\mathcal{A} \otimes \mathcal{B} \)-measurable}, then
		\begin{enumerate}[(a)]
			\item \(g(x) \coloneqq \int_Y f(x, y)\,\mathrm{d} \nu (y) \colon X\to [0, \infty ]\) is a \hyperref[def:A-measurable-function]{\(\mathcal{A}\)-measurable function}.
			\item \(h(x) \coloneqq \int_X f(x, y)\,\mathrm{d} \mu (x) \colon Y\to [0, \infty ]\) is a \hyperref[def:A-measurable-function]{\(\mathcal{B}\)-measurable function}.
			\item We have
			      \[
				      \int_{X\times Y} f \,\mathrm{d}(\mu \times \nu ) = \int _X\left(\int _Y f(x, y)\,\mathrm{d}\nu (y)\right)\mathrm{d} \mu (x) = \int _Y\left(\int_X f(x, y)\,\mathrm{d} \mu (x)\right)\mathrm{d} \nu (y).
			      \]
		\end{enumerate}
	\end{theorem*}

	\begin{theorem*}[Fubini's theorem]\label{thm:Fubini}
		If \(f\in L^1(X\times Y, \mu \times \nu )\), then
		\begin{enumerate}[(a)]
			\item \(f_{x} \in L^1(Y, \nu )\) for \hyperref[def:mu-almost-everywhere]{\(\mu\)-a.e.} \(x\), and \(g(x) \coloneqq \int_Y f(x, y)\,\mathrm{d} \nu (y) \in L^1(X, \mu )\) defined \hyperref[def:mu-almost-everywhere]{\(\mu\)-a.e.}
			\item \(f^{y} \in L^1(X, \mu )\) for \hyperref[def:mu-almost-everywhere]{\(\nu\)-a.e.} \(y\), and \(h(x) \coloneqq \int_X f(x, y)\,\mathrm{d} \mu (x) \in L^1(Y, \nu )\) defined \hyperref[def:mu-almost-everywhere]{\(\mu\)-a.e.}
			\item The iterated integral formulas hold, i.e.,
			      \[
				      \int_{X\times Y} f \,\mathrm{d}(\mu \times \nu ) = \int _X\left(\int _Y f(x, y)\,\mathrm{d}\nu (y)\right)\mathrm{d} \mu (x) = \int _Y\left(\int_X f(x, y)\,\mathrm{d} \mu (x)\right)\mathrm{d} \nu (y).
			      \]
		\end{enumerate}
	\end{theorem*}
\end{theorem}
\begin{proof}
	Read~\cite{folland1999real}.
\end{proof}

\begin{remark}
	The \hyperref[thm:Fubini]{Fubini} and \hyperref[thm:Tonelli]{Tonelli's theorem} are frequently used in tandem. Say that if one want to reverse the order of integration in a double integral \(\iint f \,\mathrm{d} \mu \,\mathrm{d} \nu \). We first verify that \(\int \left\vert f \right\vert \,\mathrm{d} (\mu \times \nu ) < \infty \) by using \hyperref[thm:Tonelli]{Tonelli's theorem} to evaluate this integral as an iterated integral. Then, we apply \hyperref[thm:Fubini]{Fubini theorem} to conclude that
	\[
		\iint f \,\mathrm{d} \mu \,\mathrm{d} \nu = \iint f \,\mathrm{d} \nu \,\mathrm{d} \mu.
	\]
\end{remark}
