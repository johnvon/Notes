\lecture{9}{13 Feb.\ 9:30}{Proof of Lévy-Cramer Continuity Theorem}
We now finish the proof of \hyperref[thm:Levy-Cramer-continuity]{Lévy-Cramer continuity theorem}.

\begin{proof}[Proof of \autoref{thm:Levy-Cramer-continuity} (cont.)]\label{pf:thm:Levy-Cramer-continuity}
	Fix \(\epsilon > 0\). Then there exists \(\delta > 0\) such that for all \(\vert t \vert < \delta \),
	\[
		\vert \phi (t) - \phi (0) \vert
		= \vert \phi (t) - 1 \vert
		< \frac{\epsilon }{4}
	\]
	since for any \(n \geq 1\), \(\phi _{X_n}(0) = 1\), so is \(\phi (0)\). Hence, we have
	\[
		\frac{\epsilon }{2}
		= \frac{1}{\delta } \int_{-\delta }^{\delta } \frac{\epsilon }{4} \,\mathrm{d}t
		> \frac{1}{\delta } \int_{-\delta }^{\delta } \vert \phi (t) - 1 \vert \,\mathrm{d}t .
	\]
	We claim that we can find an \(n_0 \in \mathbb{N} \) such that for every \(n \geq n_0\), \(\mathbb{P} (\vert X_n \vert \geq 2 / \delta ) < \epsilon \).\footnote{If this is the case, then we can handle the \(n < n_0\) case easily as usual by taking the maximum over all \(n < n_0\).} To bound \(\vert X_n \vert \) with \(\phi _{X_n}\), firstly, for all \(x\), \(\vert \sin x \vert \leq \vert x \vert \). This bound is good only when \(x\) is close to \(0\). If it's not the case, then we can use \(\vert \sin x / x \vert \leq 1 / \vert x \vert \leq 1 / 2\) if \(\vert x \vert \geq 2\). Hence, in general, for \(x \neq 0\),
	\[
		\frac{\sin x}{x}
		\leq \left\vert \frac{\sin x}{x} \right\vert
		\leq \frac{1}{2} \cdot \mathbbm{1}_{\vert x \vert \geq 2} + 1 \cdot \mathbbm{1}_{\vert x \vert < 2}
		= 1 - \frac{1}{2} \mathbbm{1}_{\vert x \vert \geq 2}
		\implies \mathbbm{1}_{\vert x \vert \geq 2}
		\leq 2 \left( 1 - \frac{\sin x}{x} \right).
	\]
	as \(\mathbbm{1}_{\vert x \vert < 2} = 1 - \mathbbm{1}_{\vert x \vert \geq 2} \). Plug in \(\delta x\), for any \(x \neq 0\), we have
	\[
		\mathbbm{1}_{\vert \delta x \vert \geq 2}
		\leq 2 \left( 1 - \frac{\sin (\delta x)}{\delta x} \right)
		= \frac{1}{\delta } \left( 2\delta - 2 \frac{\sin (\delta x)}{x} \right)
		= \frac{1}{\delta } \int_{-\delta }^{\delta } 1 - \cos (tx) \,\mathrm{d}t .
	\]
	Indeed, the above is true for all \(x \in \mathbb{R} \) by manually checking. Finally, by replacing \(x\) by \(X_n\) and take the expectation on the both sides,
	\[
		\mathbb{P} (\vert \delta X_n \vert \geq 2)
		\leq \frac{1}{\delta } \int_{-\delta }^{\delta } 1 - \mathbb{E}_{}[\cos (t X_n)] \,\mathrm{d}t
		= \frac{1}{\delta } \int_{-\delta }^{\delta } \Re (1 - \phi _{X_n}(t)) \,\mathrm{d}t
		\leq \frac{1}{\delta } \int_{-\delta }^{\delta } \vert 1 - \phi _{X_n}(t) \vert  \,\mathrm{d}t,
	\]
	where we pass the expectation (i.e., limit) inside the integral from \href{https://en.wikipedia.org/wiki/Fubini's_theorem}{Fubini's theorem} since \(\cos (t X_n)\) is bounded. It remains to show that there is some \(\delta > 0\) such that the right-hand side is less than \(\epsilon \) for all \(n \geq n_0\). As \(\phi _{X_n}(t) \to \phi (t)\) for all \(t\), we have \(\vert 1 - \phi _{X_n}(t) \vert \to \vert 1 - \phi (t) \vert \) point-wise, hence by the \href{https://en.wikipedia.org/wiki/Dominated_convergence_theorem}{bounded convergence theorem},
	\[
		\frac{1}{\delta } \int_{-\delta }^{\delta } \vert 1 - \phi _{X_n}(t) \vert  \,\mathrm{d}t
		\to \frac{1}{\delta } \int_{-\delta }^{\delta } \vert 1 - \phi (t) \vert  \,\mathrm{d}t
		< \frac{\epsilon}{2}
	\]
	from our assumption. Putting everything together, there is an \(n_0 \in \mathbb{N} \) such that for all \(n \geq n_0\),
	\[
		\mathbb{P} (\vert \delta X_n \vert \geq 2)
		= \mathbb{P} (\vert X_n \vert \geq 2 / \delta )
		\leq \frac{1}{\delta } \int_{-\delta }^{\delta } \vert 1 - \phi _{X_n}(t) \vert  \,\mathrm{d}t
		< \frac{1}{\delta } \int_{-\delta }^{\delta } \vert 1 - \phi (t) \vert  \,\mathrm{d}t + \frac{\epsilon}{2}
		< \epsilon ,
	\]
	where the second-last inequality follows from the point-wise convergence of \(\frac{1}{\delta } \int_{-\delta }^{\delta } \vert 1 - \phi _{X_n}(t) \vert \,\mathrm{d}t\) to \(\frac{1}{\delta } \int_{-\delta }^{\delta } \vert 1 - \phi (t) \vert \,\mathrm{d}t\) being \(\epsilon / 2\)-close for \(n\) large enough, i.e., when \(n \geq n_0\) for some \(n_0\).
\end{proof}

\subsection{Inversion Theorem}
On the other hand, another way to prove \hyperref[thm:Levy-Cramer-continuity]{Lévy-Cramer continuity theorem} is to directly calculate the pdf of \(X\), given \(\phi _X\). It's follows the same vein of the proof of \hyperref[thm:characteristic-function-uniqueness]{uniqueness theorem}.

\begin{intuition}
	In the proof of \hyperref[thm:characteristic-function-uniqueness]{uniqueness theorem}, we only obtain a pdf for \(X + \sigma Z\). Imposing constraints on \(\phi _X\) and calculate \(\mathbb{E}_{}[g(X)] \) in terms of \(\phi _X\) will tell us which condition should we add.
\end{intuition}

\begin{theorem}[Feller's inversion formula]\label{thm:Feller-inversion-formula}
	Let \(X\) be a \(d\)-dimensional random vector with the \hyperref[def:characteristic-function]{characteristic function} \(\phi _X\).
	\begin{enumerate}[(a)]
		\item\label{thm:Feller-inversion-formula:a} If \(g\) has a bounded support and \(\mathbb{P} (X \in C_g) = 1\), then
		      \[
			      \mathbb{E}_{}[g(X)]
			      = \lim_{\sigma \searrow 0} \frac{1}{2\pi } \iint g(x) e^{-iux - \sigma ^2 u^2 / 2} \,\mathrm{d} u \,\mathrm{d} x .
		      \]
		\item\label{thm:Feller-inversion-formula:b} For any \(a, b \in C_{F_X}\),
		      \[
			      F_X(b) - F_X(a)
			      = \lim_{\sigma \searrow 0} \frac{1}{2\pi } \int_{a}^{b} \int e^{-iux - \sigma ^2 u^2 / 2} \phi _X(u) \,\mathrm{d}u \,\mathrm{d} x .
		      \]
		\item\label{thm:Feller-inversion-formula:c} If further, \(\phi _X\) is absolute integrable, then \(X\) has a pdf
		      \[
			      f_X(x) = \frac{1}{2\pi } \int _\mathbb{R} e^{-iux} \phi _X(u) \,\mathrm{d} u.
		      \]
	\end{enumerate}
\end{theorem}
\begin{proof}
	The proof is based on \hyperref[thm:characteristic-function-uniqueness]{uniqueness theorem}.
	\begin{enumerate}[(a)]
		\item In the \hyperref[thm:characteristic-function-uniqueness]{uniqueness theorem}, \(\sigma \searrow 0\) such that \(X+ \sigma Z \overset{D}{\to } X\), which implies \(g(X + \sigma Z) \overset{D}{\to } g(X)\) when \(\mathbb{P} (X \in C_g) = 1\). Since now \(g\) is also bounded, by the \href{https://en.wikipedia.org/wiki/Dominated_convergence_theorem}{bounded convergence theorem},
		      \[
			      \mathbb{E}_{}[g(X)] = \lim_{\sigma \searrow 0} \mathbb{E}_{}[g(X + \sigma Z)].
		      \]
		      We now calculate \(\mathbb{E}_{}[g(X + \sigma Z)] \). Since \(g\colon \mathbb{R} \to \mathbb{R} \) has bounded support, the same calculation from the proof of \hyperref[thm:characteristic-function-uniqueness]{uniqueness theorem} gives
		      \[
			      \mathbb{E}_{}[g(X + \sigma Z)]
			      = \lim_{\sigma \searrow 0} \frac{1}{2\pi } \int g(x) \int e^{-i x u - \sigma ^2 u^2 / 2} \phi _X(u) \,\mathrm{d} u \,\mathrm{d} x .
		      \]
		      It remains to change the order of integration, which is justified by \href{https://en.wikipedia.org/wiki/Fubini%27s_theorem#Fubini%E2%80%93Tonelli_theorem}{Tonelli's theorem} as \(\mathbb{E}_{}[\vert g(X + \sigma Z) \vert ] < \infty \) for all \(\sigma > 0\), hence we obtain the result for the first part.
		\item Given \(a, b\in C_{F_X}\), consider \(g(x) = \mathbbm{1}_{(a, b)} (x) \), which implies \(\mathbb{P} (X \in C_g) = 1\) (and trivially \(g\) has a bounded support), hence the result above applies.
		\item Finally, if \(\phi _X\) is absolute integrable, our goal now is to pass the limit \(\sigma \searrow 0\) inside the integral for \(F_X(b) - F_X(a)\) given \(a, b \in C_{F_X}\), i.e., to get
		      \[
			      F_X(b) - F_X(a)
			      = \frac{1}{2\pi } \int_{a}^{b} \int \lim_{\sigma \searrow 0} e^{-iux - \sigma ^2 u^2 / 2} \phi _X(u) \,\mathrm{d}u \,\mathrm{d} x
			      = \frac{1}{2\pi } \int_{a}^{b} \int e^{-iux} \phi _X(u) \,\mathrm{d}u \,\mathrm{d} x ,
		      \]
		      which will imply the result since a cdf is characterized by its values in \(C_{F_X}\), i.e., if  the above equality is true, it will be valid for all \(a, b \in \mathbb{R} \). To do so, \href{https://en.wikipedia.org/wiki/Dominated_convergence_theorem}{dominated convergence theorem} states that
		      \[
			      \int_{a}^{b} \int \sup _{\sigma > 0} \left\vert e^{-i x u - \sigma ^2 u^2 / 2} \phi _X (u) \right\vert \,\mathrm{d} u \,\mathrm{d} x < \infty
		      \]
		      is the right condition. We see that the left-hand side is less than
		      \[
			      \int_{a}^{b} \int _\mathbb{R} \vert \phi _X(u) \vert \sup _{\sigma > 0} \vert e^{- \sigma ^2 u^2 / 2} \vert \,\mathrm{d} u \,\mathrm{d} x
			      \leq \int_{a}^{b} \int _\mathbb{R} \vert \phi _X(u) \vert \,\mathrm{d} u \,\mathrm{d} x
		      \]
		      which is finite since \(\int \vert \phi _X(u) \vert \,\mathrm{d} u < \infty \).
	\end{enumerate}
\end{proof}

\begin{corollary}
	Given \(X_n\) and \(X\) such that \(\phi _X\) and \(\phi _{X_n}\) are integrable. If \(\phi _{X_n} \overset{L^1}{\to } \phi _X\),\footnote{I.e., \(\int _\mathbb{R} \vert \phi _{X_n}(t) - \phi _X (t) \vert \,\mathrm{d} t \to 0\).} then \(X_n \overset{\operatorname{TV} }{\to } X\).
\end{corollary}
\begin{proof}
	It suffices to prove that \(\vert f_{X_n}(x) - f_X(x) \vert \to 0\), where these pdfs exist due to \hyperref[thm:Feller-inversion-formula]{Feller's inversion formula} \autoref{thm:Feller-inversion-formula:c}. We see that
	\[
		\vert f_{X_n}(x) - f(x) \vert
		\leq \frac{1}{2\pi } \int _{\mathbb{R} } \vert e^{-iux} \vert \cdot \vert \phi _{X_n}(u) - \phi _X(u) \vert \,\mathrm{d} u,
		\leq \frac{1}{2\pi } \int _{\mathbb{R} } \vert \phi _{X_n}(u) - \phi _X(u) \vert \,\mathrm{d} u
	\]
	with the assumption the right-hand side goes to \(0\).
\end{proof}

Finally, we see the following characterizations of \(\phi _X\). The first one is that it's uniformly continuous.

\begin{proposition}\label{prop:characteristic-function-uniformly-continuous}
	For any random vector \(X\), \(\phi _X\) is uniformly continuous, i.e.,
	\[
		\lim_{h \to 0} \sup _t \left\vert \phi _X(t + h) - \phi _X(t) \right\vert = 0.
	\]
\end{proposition}
\begin{proof}
	We see that for any \(h\),
	\[
		\left\vert \phi _{X}(t + h) - \phi _X(t) \right\vert
		= \left\vert \mathbb{E}_{}[e^{i(t + h)X}] - \mathbb{E}_{}[e^{itX}] \right\vert
		\leq \mathbb{E}_{}\left[ \left\vert e^{itX} \right\vert \left\vert e^{ihX} - 1 \right\vert \right]
		\leq \mathbb{E}_{}\left[ \left\vert e^{ihX} - 1 \right\vert \right],
	\]
	which goes to \(0\) as \(h \to 0\) since \(\vert e^{ihX} - 1\vert \leq 2\) with \href{https://en.wikipedia.org/wiki/Dominated_convergence_theorem}{bounded convergence theorem}.
\end{proof}

The next theorem gives us a way to calculate the derivatives of \(\phi _X\).

\begin{theorem}\label{thm:characteristic-function-derivative}
	If \(X \in L ^p\) for any \(p \in \mathbb{N} \), then the \(p^{\text{th} }\) derivative of \(\phi _X(t)\) is given by
	\[
		\phi _X^{(p)} (t) = \mathbb{E}_{}[(iX)^p e^{itX}]
	\]
	for every \(t\). In particular, \(\phi _X^{(p)}(0) = i^p \mathbb{E}_{}[X^p] \).
\end{theorem}
\begin{proof}
	We prove the case \(p = 1\) since for \(p > 1\), it can be shown similarly with induction. It's enough to prove
	\[
		\lim_{h \to 0} \left\vert \frac{\phi _X(t + h) - \phi _X(t)}{h} - \mathbb{E}_{}\left[i X e^{itX}\right] \right\vert = 0
	\]
	Writing the \(\phi _X\) explicitly, by Jensen's inequality, for any \(h \neq 0\), the left-hand side is
	\[
		\begin{split}
			\left\vert \frac{\mathbb{E}_{}\left[e^{i(t + h) X}\right] - \mathbb{E}_{}\left[e^{itX}\right] - \mathbb{E}_{}\left[ihX e^{itX}\right] }{h} \right\vert
			 & \leq \frac{\mathbb{E}_{}\left[\left\vert e^{i(t + h) X} - e^{itX} - ihX e^{itX} \right\vert \right] }{\vert h \vert }             \\
			 & = \frac{\mathbb{E}_{}\left[\left\vert e^{i t X}  \right\vert \left\vert e^{i h X} - 1 - ihX \right\vert \right] }{\vert h \vert }
			\leq \frac{\mathbb{E}_{}\left[\left\vert e^{i h X} - 1 - ihX \right\vert \right] }{\vert h \vert }
		\end{split}
	\]
	Let \(G(h) = e^{ihX}\), then \(G^{\prime} (h) = iX e^{ihX}\), and the right-hand side is equal to
	\[
		\frac{\mathbb{E}_{}\left[\left\vert G(h) - G(0) - G^{\prime} (0) h \right\vert \right]}{\vert h \vert } .
	\]
	Since \(G\) is differentiable, \(G(h)-G(0) = \int_{0}^{h} G^{\prime} (y) \,\mathrm{d}y \), hence
	\[
		G(h) - G(0) - G^{\prime} (0) h
		= \int_{0}^{h} G^{\prime} (y) - G^{\prime} (0) \,\mathrm{d}y
		= h \int_{0}^{1} G^{\prime} (uh) - G^{\prime} (0) \,\mathrm{d}u
		= h \int_{0}^{1} iX e^{iuhX} - iX \,\mathrm{d}u
	\]
	where we let \(y = u h\). Plugging in, we have
	\[
		\begin{split}
			\mathbb{E}_{}\left[\frac{\left\vert e^{ihX} - 1 - ihX \right\vert }{\vert h \vert }\right]
			 & \leq \mathbb{E}_{}\left[\int_{0}^{1} \vert G^{\prime} (uh) - G^{\prime} (0) \vert \,\mathrm{d}u \right] \\
			 & = \mathbb{E}_{}\left[\int_{0}^{1} \vert iX e^{iuhX} - iX \vert \,\mathrm{d}u \right]
			\leq \mathbb{E}_{}\left[\vert X \vert \int_{0}^{1} \vert e^{iuhX} - 1 \vert \,\mathrm{d}u \right].
		\end{split}
	\]
	Finally, taking the limit as \(h \to 0\), with the fact that \(\mathbb{E}_{}[\vert X \vert ] < \infty \) and \(\int_{0}^{1} \vert e^{i hu X} - 1 \vert \,\mathrm{d}u \leq 2\), we see that \(\vert X \vert \int_{0}^{1} \vert e^{ihuX} - 1 \vert \,\mathrm{d}u \leq 2 \vert X \vert \), and the latter is integrable since \(\mathbb{E}_{}[X] < \infty \), hence \href{https://en.wikipedia.org/wiki/Dominated_convergence_theorem}{dominated convergence theorem} applies, i.e., we can pass the limit into the expectation,
	\[
		\lim_{h \to 0} \mathbb{E}_{}\left[\vert X \vert \int_{0}^{1} \vert e^{ihuX} - 1 \vert \,\mathrm{d}u \right]
		= \mathbb{E}_{}\left[\vert X \vert \lim_{h \to 0} \int_{0}^{1} \vert e^{ihuX} - 1 \vert \,\mathrm{d}u \right]
		= 0
	\]
	since \(\lim_{h \to 0} \int_{0}^{1} \vert e^{iuhX} - 1\vert \,\mathrm{d}u = 0\), again from the \href{https://en.wikipedia.org/wiki/Dominated_convergence_theorem}{bounded convergence theorem}.
\end{proof}

\begin{remark}
	\autoref{thm:characteristic-function-derivative} implies \(\sup _t \vert \phi _X^{(p)} (t) \vert \leq \mathbb{E}_{}[\vert X \vert ^p] \), which is finite by the assumption \(X \in L^p\).
\end{remark}

A more useful consequence is the following, generalizing \autoref{prop:characteristic-function-uniformly-continuous}.

\begin{corollary}
	If \(X \in L^p\) for some \(p \in \mathbb{N} \), then \(\phi _X^{(p)}\) is uniformly continuous.
\end{corollary}
\begin{proof}
	To show that \(\phi _X^{(p)}\) is uniformly continuous, we show that \(\sup _{t\in \mathbb{R} } \vert \phi ^{(p)}(t + h) - \phi _X^{(p)}(t) \vert \to 0\) as \(h \to 0\). But this is clear since for any \(h \in \mathbb{R} \), with \autoref{thm:characteristic-function-derivative},
	\[
		\sup _{t\in \mathbb{R} } \vert \phi _X^{(p)} (t + h) - \phi _X^{(p)}(t) \vert
		\leq \mathbb{E}_{}\left[\vert X \vert ^p \vert e^{ih X} - 1\vert \right],
	\]
	which goes to \(0\) as \(h \to 0\) from the \href{https://en.wikipedia.org/wiki/Dominated_convergence_theorem}{dominated convergence theorem}.
\end{proof}