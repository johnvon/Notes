\lecture{24}{4 Apr. 11:30}{Ultrapowers and the Łoś's Theorem}
\section{Ultrapowers}
\begin{notation}
	Now, we write \([a_i]\) for \([(a_i)_{i\in I}]\).
\end{notation}

\begin{notation}[Almost everywhere]\label{not:a.e.}
	When something happens on a set in the \hyperref[def:ultrafilter]{ultrafilter}, we say that it happens \emph{almost everywhere}.
\end{notation}

\begin{eg}
	If \(a \sim b\), then \(a\) and \(b\) are equal \hyperref[not:a.e.]{almost everywhere}.
\end{eg}

\hyperref[def:ultraproduct]{Ultraproducts} are only interesting when the \hyperref[def:ultrafilter]{ultrafilter} is non-\hyperref[eg:principal-filter]{principal}; otherwise, the \hyperref[def:ultraproduct]{ultraproduct} is just isomorphic to one of the facts, i.e., the dictator.

\begin{definition}[Ultrapower]\label{def:ultrapower}
	Fix a single \hyperref[def:structure]{structure} \(\mathcal{M} \) and take \(\mathcal{M} _i = \mathcal{M} \) for every \(i \in I\). The \emph{ultrapower} is defined as \(\prod_{i\in I} \quotient{\mathcal{M} }{\mathcal{U} } \).
\end{definition}

\begin{remark}
	\(\mathcal{M} \hookrightarrow \prod \quotient{\mathcal{M} }{\mathcal{U} } \) is an \hyperref[def:embedding]{embedding}.
\end{remark}
\begin{explanation}
	Consider the constant sequence embedding \(a \mapsto [(a)_{i\in I}]\).
\end{explanation}

Let's first see one example.

\begin{eg}[Non-standard reals]
	Let \(\mathcal{U} \) be a non-\hyperref[eg:principal-filter]{principal} \hyperref[def:ultrafilter]{ultrafilter} on \(I = \mathbb{N} \), and let \(\mathbb{R} ^{\ast} = \prod \quotient{\mathbb{R} }{\mathcal{U} } \).

	Then, we see that \(\mathbb{R} \hookrightarrow \mathbb{R} ^{\ast} \) by \(r \mapsto [r]\), i.e., the constant sequence \(r\). This is a field embedding of fields.\footnote{Since, for example, \([r] + [s] = [r + s]\), and \(1 \mapsto [1]\) is the multiplicative identity of \(\mathbb{R} ^{\ast} \).} However, \(\mathbb{R} ^{\ast} \) has other elements, e.g., \([(n)_{n\in \mathbb{N} }]\) and \([(1 / n)_{n\in \mathbb{N} }]\), and for each \(r\in \mathbb{R} \), \([(n)] \geq r = [r]\).\footnote{Since \(\left\{ n \mid n \geq r \right\} \) is \hyperref[def:cofinite]{cofinite} and  \(\mathcal{U} \) is non-\hyperref[eg:principal-filter]{principal}, hence in \(\mathcal{U} \). This is what it means to have \([(n)] \geq [r]\) in \(\mathbb{R} ^{\ast} \).} Similarly, \([(1 / n)]\) is infinitesimal, i.e., \(0 < [1 / n] < r\) for all \(r\in \mathbb{R} ^+\). It's possible to develop calculus by using infinitesimal elements of \(\prod_{i\in \mathbb{N} } \quotient{\mathbb{R}}{\mathcal{U} } \) instead of limits.
\end{eg}

\begin{eg}
	Let \(a_i = 1\) for odd \(i\), or \(2\) for even \(i\). Then either \([a_i] = 1\) or \([a_i] = 2\) depending on \(\mathcal{U} \).
\end{eg}

\begin{eg}
	\([n+1] = [n] + [1]\), \([n^2] = [n] [n]\). We have \([n^2] \geq [n+a] = [n] + a\) for all \(a\in \mathbb{N} \).
\end{eg}

\subsection{\defaultL{}oś's theorem}
The power of \hyperref[def:ultraproduct]{ultraproducts} is that what is \hyperref[def:truth]{true} in an \hyperref[def:ultraproduct]{ultraproduct} is exactly what is \hyperref[def:truth]{true} in almost all coordinates. This is the \hyperref[thm:Los]{\defaultL{}oś's theorem}.\footnote{Pronounced as ``wash''.}

\begin{theorem}[\defaultL{}oś's theorem]\label{thm:Los}
	Let \(\mathcal{L} \) be a \hyperref[def:language]{language}, and \(\mathcal{U} \) an \hyperref[def:ultrafilter]{ultrafilter} on \(I\). And for \(i\in I\), we have an \hyperref[def:structure]{\(\mathcal{L} \)-structure} \(\mathcal{A} _i\). Then, for each \(a_i^1, \dots , a_i^n\in A_i\),
	\[
		\prod_{i\in I} \quotient{\mathcal{A} _i}{\mathcal{U} } \models \varphi ([a_i^1], \dots , [a_i^n]) \iff \left\{ i\in I \mid \mathcal{A} _i \models \varphi (a_i^1, \dots , a_i^n) \right\} \in \mathcal{U} .
	\]
\end{theorem}
\begin{proof}
	We do an induction on \hyperref[def:formula]{formulas}. For simplicity, assume that the \hyperref[def:language]{language} is relational by replacing \(n\)-ary functions by \(n+1\)-ary relations.\footnote{If there are function symbols, one must also do induction on \hyperref[def:term]{terms}.} For \hyperref[not:atomic]{atomic} \hyperref[def:formula]{formulas} (equality and relations), it's straightforward from the definitions.
	\begin{itemize}
		\item Suppose the claim holds for \(\varphi \) and \(\psi \). Then
		      \begin{equation}\label{eq:Los}
			      \left\{ i \mid \mathcal{A} _i \models \varphi (a_i^1, \dots , a_i^n) \right\}
			      \cap \left\{ i \mid \mathcal{A} _i \models \psi _i(a_i^1, \dots , a_i^n) \right\}
			      = \left\{ i \mid \mathcal{A} _i \models (\varphi \land \psi )(a_i^1, \dots , a_i^n) \right\},
		      \end{equation}
		      implying that
		      \[
			      \prod_{i\in I} \quotient{\mathcal{A} _i}{\mathcal{U} } \models \varphi (a_i^1, \dots , a_i^n)
			      \text{ and } \prod_{i\in I} \quotient{\mathcal{A} _i}{\mathcal{U} } \models \psi (a_i^1, \dots , a_i^n)
			      \iff \prod_{i\in I} \quotient{\mathcal{A} _i}{\mathcal{U} } \models (\varphi \land \psi )(a_i^1, \dots , a_i^n).
		      \]
		      And from the induction hypotheses, the left-hand side of \autoref{eq:Los} are both in \(\mathcal{U} \), hence the right-hand side.
		\item Suppose it holds for \(\varphi \). Then
		      \[
			      \begin{split}
				      \prod_{i\in I} \quotient{\mathcal{A}_i }{\mathcal{U} } \models \lnot \varphi (a_i^1, \dots , a_i^n)
				      &\iff \prod_{i\in I} \quotient{\mathcal{A}_i }{\mathcal{U} } \not \models \varphi (a_i^1, \dots , a_i^n)\\
				      &\iff \left\{ i \mid \mathcal{A} _i \models \varphi (a_i^1, \dots , a_i^n) \right\} \notin \mathcal{U} \\
				      &\iff \left\{ i \mid \mathcal{A} _i \models \lnot \varphi (a_i^1, \dots , a_i^n) \right\} \in \mathcal{U} .
			      \end{split}
		      \]
		\item Suppose it holds for \(\varphi \), and suppose \(\prod_{i\in I} \quotient{\mathcal{A}_i }{\mathcal{U} } \models \exists x\ \varphi (x, a_i^1, \dots , a_i^n)\). Pick \([b_i]\) such that \(\prod_{i\in I} \quotient{\mathcal{A}_i }{\mathcal{U} } \models \varphi ([b_i], a_i^1, \dots , a_i^n)\). Then by the induction hypotheses,
		      \[
			      \left\{ i \mid \mathcal{A} _i \models \varphi (b_i, a_i^1, \dots , a_i^n) \right\} \in \mathcal{U},
		      \]
		      hence \(\left\{ i \mid \mathcal{A} \models \exists x\ \varphi (x, a_i^1, \dots , a_i^n) \right\} \in \mathcal{U} \) since it contains \(\left\{ i \mid \mathcal{A} _i \models \varphi (b_i, a_i^1, \dots , a_i^n) \right\}\).

		      On the other hand, suppose \(\left\{ i \mid \mathcal{A} _i \models \exists x\ \varphi (x, a_i^1, \dots , a_i^n) \right\} \in \mathcal{U} \). For each \(i\) in this set, pick \(b_i\in A_i\) such that \(\mathcal{A} _i \models \varphi (b_i, a_i^1, \dots , a_i^n)\). For all other \(i\), pick any \(b_i\). Then,
		      \[
			      \left\{ i \mid \mathcal{A} _i \models \varphi (b_i, a_i^1, \dots , a_i^n) \right\} \in \mathcal{U}.
		      \]
		      By the induction hypotheses, \(\prod_{i\in I} \quotient{\mathcal{A}_i }{\mathcal{U} } \models \varphi ([b_i], a_i^1, \dots , a_i^n)\), so
		      \[
			      \prod_{i\in I} \quotient{\mathcal{A}_i }{\mathcal{U} } \models \exists x\ \varphi (x, a_i^1, \dots , a_i^n).
		      \]
	\end{itemize}
\end{proof}

We then have the following immediate consequences.

\begin{note}[Non-standard reals]
	\(\mathcal{M} \hookrightarrow \prod \quotient{\mathcal{M} }{\mathcal{U} } \) is an \hyperref[def:elementary-embedding]{elementary embedding}, i.e.,
	\[
		\mathcal{M} \models \varphi (a_1, \dots , a_n) \iff \prod \quotient{\mathcal{M} }{\mathcal{U} } \models \varphi ([a_1], \dots , [a_n]).
	\]
\end{note}

\begin{eg}
	\(\mathbb{R} \hookrightarrow \mathbb{R} ^{\ast} \) is \hyperref[def:elementary-embedding]{elementary}, and \(\mathbb{R} \equiv \mathbb{R} ^{\ast} \).\footnote{\(\mathbb{R} ^{\ast} \) is also a real closed filed.}
\end{eg}

\begin{eg}[Pseudofinite field]
	Let \(\mathcal{U} \) be a non-\hyperref[eg:principal-filter]{principal} \hyperref[def:ultrafilter]{ultrafilter} on \(I\), where \(I\) is the set of primes \(p\). Let \(F = \prod \quotient{\mathbb{F} _p}{\mathcal{U} } \), which is a field from the \hyperref[thm:Los]{\defaultL{}oś's theorem}.\footnote{Since we know that \(F\) has every property that \(\mathbb{F} _p\) has.} Furthermore, \(F\) has \hyperref[def:characteristic]{characteristic} \(0\) because for each \(q\), \(\{ p \mid \mathbb{F} _p \models \underbrace{1 + \dots + 1}_{q} \} = \{ q \} \notin \mathcal{U} \).

	\(F\) is infinite, and if \(\varphi \) is a \hyperref[def:sentence]{sentence} \hyperref[def:truth]{true} in any finite field, \(\mathbb{F} _p \models \varphi \) for all \(p\), so \(F \models \varphi \). We call \(F\) a \emph{pseudofinite field}.
\end{eg}

\begin{note}
	\(\mathbb{F} _p^{\mathrm{alg} } = \bigcup \mathbb{F} _{p^n}\).
	% https://q.uiver.app/?q=WzAsNCxbMSwwLCJcXG1hdGhiYntGfV97cF42fSJdLFswLDEsIlxcbWF0aGJie0Z9X3twXjN9Il0sWzIsMSwiXFxtYXRoYmJ7Rn1fe3BeMn0iXSxbMSwyLCJcXG1hdGhiYntGfV97cH0iXSxbMywyLCIiLDAseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzIsMCwiIiwwLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFsxLDAsIiIsMix7InN0eWxlIjp7ImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbMywxLCIiLDIseyJzdHlsZSI6eyJoZWFkIjp7Im5hbWUiOiJub25lIn19fV1d
	\[\begin{tikzcd}
			& {\mathbb{F}_{p^6}} \\
			{\mathbb{F}_{p^3}} && {\mathbb{F}_{p^2}} \\
			& {\mathbb{F}_{p}}
			\arrow[no head, from=3-2, to=2-3]
			\arrow[no head, from=2-3, to=1-2]
			\arrow[no head, from=2-1, to=1-2]
			\arrow[no head, from=3-2, to=2-1]
		\end{tikzcd}\]
\end{note}

\subsection{Another Proof of the Compactness Theorem}
One application to \hyperref[thm:Los]{\defaultL{}oś's theorem} is a proof of the \hyperref[thm:compactness]{compactness theorem} without passing through the \hyperref[thm:completeness]{completeness theorem}.

\begin{prev}[Compactness theorem]
	Suppose that \(T\) is a finitely \hyperref[def:satisfiable]{satisfiable} \hyperref[def:theory]{theory}. Then \(T\) is \hyperref[def:satisfiable]{satisfiable}.
\end{prev}
\begin{proof}[Another proof of \autoref{thm:compactness}]
	Let \(T\) be an infinite \hyperref[def:theory]{\(\mathcal{L} \)-theory} which is finitely \hyperref[def:satisfiable]{satisfiable}. Let \(I\) be the collection of finite subsets of \(T\). Then, for each \(\Delta \in I\), let \(X_\Delta = \left\{ \Lambda \in I \mid \Delta  \subseteq \Lambda  \right\} \). Let
	\[
		D = \left\{ Y \subseteq I \mid X_\Delta \subseteq Y\text{ for some } \Delta \in I \right\}.
	\]

	\begin{claim}
		\(D\) is a \hyperref[def:filter]{filter}.
	\end{claim}
	\begin{explanation}
		We see that
		\begin{enumerate}[(a)]
			\item \(\varnothing \notin D\) since each \(X_\Delta \neq \varnothing \); and \(I \in D\) since \(X_\Delta \subseteq I\) for any \(\Delta \);
			\item if \(Y\in D\) and \(Z\supseteq Y\), then \(X_\Delta \subseteq Y\) implies \(X_\Delta \subseteq Z\) for some \(\Delta \);
			\item if \(Y\in D\) and \(Z\in D\), then there are \(\Delta , \Lambda \) such that \(X_\Delta \subseteq Y\) and \(X_\Lambda \subseteq Z\). Then
			      \[
				      X_{\Delta \cup \Lambda } = X_\Delta \cap X_\Lambda \subseteq Y \cap Z,
			      \]
			      so \(Y \cap Z\in D\) for \(\Delta \cup \Lambda \).
		\end{enumerate}
	\end{explanation}

	Let \(\mathcal{U} \) be an \hyperref[def:ultrafilter]{ultrafilter} on \(I\) extending \(D\). For each \(\Delta \in I\), choose \(\mathcal{M} _\Delta \models \Delta \) since \(T\) is finitely \hyperref[def:satisfiable]{satisfiable}. Let \(\mathcal{M} = \prod_{\Delta \in I} \quotient{\mathcal{M} _\Delta }{\mathcal{U} } \).

	\begin{claim}
		\(\mathcal{M} \models T\).
	\end{claim}
	\begin{explanation}
		Let \(\varphi \in T\), then \(X_{\{ \varphi  \} }\in D \subseteq \mathcal{U} \) and \(\{ \Delta \in I \mid \mathcal{M} _\Delta \models \varphi \} \supseteq \{ \Delta \in I \mid \Delta  \ni \varphi \} = X_{\{ \varphi \} } \in \mathcal{U} \). From \hyperref[thm:Los]{\defaultL{}oś's theorem},
		\[
			\{ \Delta \in I \mid \mathcal{M} _\Delta \models \varphi  \} \in \mathcal{U}
			\iff \mathcal{M} \models \varphi ,
		\]
		so \(\mathcal{M} \models \varphi \), hence \(\mathcal{M} \models T\).
	\end{explanation}
\end{proof}

\begin{intuition}
	\todo{Fill this up}
\end{intuition}

If \(\mathcal{L} \) is countable, we could list the \hyperref[def:sentence]{sentences} \(\varphi _1, \varphi _2, \dots \) of \(T\). Then, we pick \(\mathcal{M} _i \models \varphi _1 \land \dots \land \varphi _i\). If \(\mathcal{U} \) is any non-\hyperref[eg:principal-filter]{principal} \hyperref[def:ultrafilter]{ultrafilter}, \(\prod \quotient{\mathcal{M} _i}{\mathcal{U} } \models \varphi _i\) for all \(i\).