\lecture{21}{23 Mar. 14:30}{Proof of Fraïssé Theorem}
\begin{prev}
	We want to build an infinite structure from finite pieces.
\end{prev}

To prove the \hyperref[thm:Fraisse]{Fraïssé theorem}, we need the following lemma.

\begin{lemma}
	Let \(\mathbb{K} \) have the \hyperref[def:AP]{amalgamation property}. Then for \(\mathcal{B} , \mathcal{A} _1, \ldots , \mathcal{A} _n, \mathcal{C} _1, \ldots , \mathcal{C} _n \in \mathbb{K} \) with \hyperref[def:embedding]{embeddings} % https://q.uiver.app/?q=WzAsMyxbMSwxLCJcXG1hdGhjYWx7QX1faSJdLFsyLDAsIlxcbWF0aGNhbHtDfV9pIl0sWzAsMCwiXFxtYXRoY2Fse0J9Il0sWzAsMiwiZl9pIl0sWzAsMSwiZ19pIiwyXV0=
	\(\begin{tikzcd}
		{\mathcal{B}} && {\mathcal{C}_i} \\
		& {\mathcal{A}_i}
		\arrow["{f_i}", from=2-2, to=1-1]
		\arrow["{g_i}"', from=2-2, to=1-3]
	\end{tikzcd}\), there exists \(\mathcal{D} \in \mathbb{K} \) with \hyperref[def:embedding]{embedding}
	% https://q.uiver.app/?q=WzAsMyxbMSwwLCJcXG1hdGhjYWx7RH0iXSxbMCwxLCJcXG1hdGhjYWx7Qn0iXSxbMiwxLCJcXG1hdGhjYWx7Q31faSJdLFsxLDAsIlxcd2lkZXRpbGRle2Z9Il0sWzIsMCwiXFx3aWRldGlsZGV7Z31faSIsMl1d
	\(\begin{tikzcd}
		& {\mathcal{D}} \\
		{\mathcal{B}} && {\mathcal{C}_i}
		\arrow["{\widetilde{f}}", from=2-1, to=1-2]
		\arrow["{\widetilde{g}_i}"', from=2-3, to=1-2]
	\end{tikzcd}\) such that \(\widetilde{f} \circ f_i = \widetilde{g} _i \circ g_i\), i.e.,
	% https://q.uiver.app/?q=WzAsMTAsWzEsMiwiXFxtYXRoY2Fse0F9XzEiXSxbMiwyLCJcXG1hdGhjYWx7QX1fMiJdLFszLDIsIlxcbWF0aGNhbHtBfV8zIl0sWzAsMSwiXFxtYXRoY2Fse0J9Il0sWzIsMSwiXFxtYXRoY2Fse0N9XzEiXSxbMywxLCJcXG1hdGhjYWx7Q31fMiJdLFs0LDEsIlxcbWF0aGNhbHtDfV8zIl0sWzUsMSwiXFxsZG90cyJdLFs0LDIsIlxcbGRvdHMiXSxbMSwwLCJcXG1hdGhjYWx7RH0iXSxbMCwzLCJmXzEiXSxbMCw0LCJnXzEiLDIseyJsYWJlbF9wb3NpdGlvbiI6MTAwfV0sWzEsNSwiZ18yIiwyLHsibGFiZWxfcG9zaXRpb24iOjEwMH1dLFsyLDYsImdfMyIsMix7ImxhYmVsX3Bvc2l0aW9uIjoxMDB9XSxbMSwzLCJmXzIiXSxbMiwzLCJmXzMiLDIseyJsYWJlbF9wb3NpdGlvbiI6NjB9XSxbMyw5LCJcXHdpZGV0aWxkZXtmfSJdLFs0LDksIlxcd2lkZXRpbGRle2d9XzEiXSxbNSw5LCJcXHdpZGV0aWxkZXtnfV8yIiwwLHsibGFiZWxfcG9zaXRpb24iOjEwfV0sWzYsOSwiXFx3aWRldGlsZGV7Z31fMyIsMCx7ImxhYmVsX3Bvc2l0aW9uIjoxMH1dXQ==
	\[\begin{tikzcd}
			& {\mathcal{D}} \\
			{\mathcal{B}} && {\mathcal{C}_1} & {\mathcal{C}_2} & {\mathcal{C}_3} & \ldots \\
			& {\mathcal{A}_1} & {\mathcal{A}_2} & {\mathcal{A}_3} & \ldots
			\arrow["{f_1}", from=3-2, to=2-1]
			\arrow["{g_1}"'{pos=1}, from=3-2, to=2-3]
			\arrow["{g_2}"'{pos=1}, from=3-3, to=2-4]
			\arrow["{g_3}"'{pos=1}, from=3-4, to=2-5]
			\arrow["{f_2}", from=3-3, to=2-1]
			\arrow["{f_3}"'{pos=0.6}, from=3-4, to=2-1]
			\arrow["{\widetilde{f}}", from=2-1, to=1-2]
			\arrow["{\widetilde{g}_1}", from=2-3, to=1-2]
			\arrow["{\widetilde{g}_2}"{pos=0.1}, from=2-4, to=1-2]
			\arrow["{\widetilde{g}_3}"{pos=0.1}, from=2-5, to=1-2]
		\end{tikzcd}\]
\end{lemma}
\begin{proof}
	By induction on \(n\) with \hyperref[def:AP]{amalgamation property}, we have
	% https://q.uiver.app/?q=WzAsNyxbMSwzLCJcXG1hdGhjYWx7QX1fMSJdLFsyLDMsIlxcbWF0aGNhbHtBfV8yIl0sWzAsMiwiXFxtYXRoY2Fse0J9Il0sWzIsMiwiXFxtYXRoY2Fse0N9XzEiXSxbMywyLCJcXG1hdGhjYWx7Q31fMiJdLFsxLDEsIlxcbWF0aGNhbHtEfV8xIl0sWzIsMCwiXFxtYXRoY2Fse0R9XzIiXSxbMSw0XSxbMCwzXSxbMCwyXSxbMiw1LCIiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMyw1LCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMSwyXSxbNCw2LCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbNSw2LCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMSw1LCIiLDAseyJjdXJ2ZSI6LTIsInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRvdHRlZCJ9fX1dXQ==
	\[\begin{tikzcd}
			&& {\mathcal{D}_2} \\
			& {\mathcal{D}_1} \\
			{\mathcal{B}} && {\mathcal{C}_1} & {\mathcal{C}_2} \\
			& {\mathcal{A}_1} & {\mathcal{A}_2}
			\arrow[from=4-3, to=3-4]
			\arrow[from=4-2, to=3-3]
			\arrow[from=4-2, to=3-1]
			\arrow[dashed, from=3-1, to=2-2]
			\arrow[dashed, from=3-3, to=2-2]
			\arrow[from=4-3, to=3-1]
			\arrow[dashed, from=3-4, to=1-3]
			\arrow[dashed, from=2-2, to=1-3]
			\arrow[curve={height=-12pt}, dotted, from=4-3, to=2-2]
		\end{tikzcd}\]
\end{proof}

Now, we try to prove the \hyperref[thm:Fraisse]{Fraïssé theorem}.

\begin{proof}[Proof of \autoref{thm:Fraisse}]
	To prove the forward direction, we need only to check \hyperref[def:AP]{AP} for \(\Age(\mathcal{M} )\). We use \hyperref[def:EP]{EP} to extend \(\mathcal{A} \hookrightarrow \mathcal{B} \hookrightarrow \mathcal{M} \) along \(\mathcal{A} \hookrightarrow \mathcal{C} \). Let \(\mathcal{D} \) be the union of images of \(\mathcal{C} \hookrightarrow \mathcal{M} \) and \(\mathcal{B} \hookrightarrow \mathcal{M} \).
	% https://q.uiver.app/?q=WzAsNCxbMCwwLCJcXG1hdGhjYWx7QX0iXSxbMSwwLCJcXG1hdGhjYWx7Qn0iXSxbMSwxLCJcXG1hdGhjYWx7RH1cXHN1YnNldGVxXFxtYXRoY2Fse019Il0sWzAsMSwiXFxBZ2UoXFxtYXRoY2Fse019KVxcbmlcXG1hdGhjYWx7Q30iXSxbMywyLCJcXGV4aXN0cyBcXHRleHR7IGJ5IFxcaHlwZXJyZWZbZGVmOkVQXXtFUH19IiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzEsMiwiIiwyLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoiaG9vayIsInNpZGUiOiJib3R0b20ifX19XSxbMCwzLCIiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJob29rIiwic2lkZSI6ImJvdHRvbSJ9fX1dLFswLDEsImYiLDAseyJzdHlsZSI6eyJ0YWlsIjp7Im5hbWUiOiJob29rIiwic2lkZSI6InRvcCJ9fX1dLFswLDIsIiIsMCx7ImN1cnZlIjotMn1dLFs4LDQsIiIsMCx7InNob3J0ZW4iOnsic291cmNlIjoyMCwidGFyZ2V0IjoyMH0sImxldmVsIjoxLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJzcXVpZ2dseSJ9fX1dXQ==
	\[\begin{tikzcd}
			{\mathcal{A}} & {\mathcal{B}} \\
			{\Age(\mathcal{M})\ni\mathcal{C}} & {\mathcal{D}\subseteq\mathcal{M}}
			\arrow[""{name=0, anchor=center, inner sep=0}, "{\exists \text{ by \hyperref[def:EP]{EP}}}"', dashed, from=2-1, to=2-2]
			\arrow[hook', from=1-2, to=2-2]
			\arrow[hook', from=1-1, to=2-1]
			\arrow["f", hook, from=1-1, to=1-2]
			\arrow[""{name=1, anchor=center, inner sep=0}, curve={height=-12pt}, from=1-1, to=2-2]
			\arrow[shorten <=4pt, shorten >=4pt, squiggly, from=1, to=0]
		\end{tikzcd}\]

	For the backward direction, we'll build \(\mathcal{M} _0 \subseteq \mathcal{M} _1 \subseteq \ldots \) as in \hyperref[thm:baby-Fraisse]{baby Fraïssé theorem} to ensure \(\mathcal{M} \) obeys countably many ``conditions''. A ``condition'' means:
	\begin{itemize}
		\item a \hyperref[def:structure]{structure} \(\mathcal{A} \in \mathbb{K} \) (means we need to \hyperref[def:embedding]{embed} \(\mathcal{A} \) into \(\mathcal{M} _n\) at some stage),
		\item a tuple \((\mathcal{A} , \mathcal{B} , g)\) where \(\mathcal{A} , \mathcal{B} \in \mathbb{K} \) and \(g\) is an \hyperref[def:embedding]{embedding} \(\mathcal{A} \hookrightarrow \mathcal{B} \) (means we need to \hyperref[def:AP]{amalgamate} \(g\) into \(\mathcal{M} _n\)).
	\end{itemize}

	Then, we list al conditions
	\[
		\left( \mathcal{A} _0, (\mathcal{A} _1, \mathcal{B} , g_1), \mathcal{A} _2, (\mathcal{A} _3, \mathcal{B} _3, g_3), \ldots  \right)
	\]
	such that each condition of second type occurs infintely often. Consider
	% https://q.uiver.app/?q=WzAsMjUsWzAsMSwiXFxtYXRoY2Fse019XzAiXSxbMSwxLCJcXG1hdGhjYWx7TX1fMSJdLFsyLDEsIlxcbWF0aGNhbHtNfV8yIl0sWzAsMiwiXFxtYXRoY2Fse0F9XzEiXSxbMCwzLCJcXG1hdGhjYWx7QX1fMSJdLFsxLDMsIlxcbWF0aGNhbHtCfV8xIl0sWzEsNCwiXFxtYXRoY2Fse0J9XzEiXSxbMSw1LCJcXG1hdGhjYWx7Qn1fMSJdLFswLDQsIlxcbWF0aGNhbHtBfV8xIl0sWzAsMCwiXFxtYXRoY2Fse0F9XzAiXSxbMCw1LCJcXHZkb3RzIl0sWzEsNiwiXFx2ZG90cyJdLFszLDEsIlxcbWF0aGNhbHtNfV8zIl0sWzIsMCwiXFxtYXRoY2Fse0F9XzIiXSxbMiwyLCJcXG1hdGhjYWx7QX1fMyJdLFsyLDMsIlxcbWF0aGNhbHtBfV8zIl0sWzIsNCwiXFxtYXRoY2Fse0F9XzMiXSxbMiw1LCJcXHZkb3RzIl0sWzMsMywiXFxtYXRoY2Fse0J9XzMiXSxbMyw0LCJcXG1hdGhjYWx7Qn1fMyJdLFszLDUsIlxcbWF0aGNhbHtCfV8zIl0sWzMsNiwiXFx2ZG90cyJdLFs0LDEsIlxcbWF0aGNhbHtNfV80Il0sWzUsMSwiXFxsZG90cyJdLFs2LDEsIlxcbWF0aGNhbHtNfT1cXGJpZ2N1cF9uIFxcbWF0aGNhbHtNfV9uIl0sWzAsMSwiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzksMSwiIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzMsMSwiZl97MSwxfSIsMCx7ImxhYmVsX3Bvc2l0aW9uIjoxMH1dLFs0LDEsImZfezEsMn0iLDAseyJsYWJlbF9wb3NpdGlvbiI6MTB9XSxbOCwxLCJmX3sxLDN9IiwwLHsibGFiZWxfcG9zaXRpb24iOjEwfV0sWzMsNSwiZ18xIiwwLHsibGFiZWxfcG9zaXRpb24iOjcwfV0sWzQsNiwiZ18xIiwwLHsibGFiZWxfcG9zaXRpb24iOjcwfV0sWzgsNywiZ18xIiwwLHsibGFiZWxfcG9zaXRpb24iOjcwfV0sWzUsMiwiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzYsMiwiIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzcsMiwiIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzEsMiwiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzIsMTIsIiIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFsxMywxMiwiIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzE2LDIwLCJnXzMiLDAseyJsYWJlbF9wb3NpdGlvbiI6NzB9XSxbMTUsMTksImdfMyIsMCx7ImxhYmVsX3Bvc2l0aW9uIjo3MH1dLFsxNCwxOCwiZ18zIiwwLHsibGFiZWxfcG9zaXRpb24iOjcwfV0sWzE0LDEyLCJmX3syLDF9IiwwLHsibGFiZWxfcG9zaXRpb24iOjEwfV0sWzE1LDEyLCJmX3syLDJ9IiwwLHsibGFiZWxfcG9zaXRpb24iOjEwfV0sWzE2LDEyLCJmX3syLDN9IiwwLHsibGFiZWxfcG9zaXRpb24iOjEwfV0sWzE4LDIyLCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMTksMjIsIiIsMSx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFsyMCwyMiwiIiwxLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzEyLDIyLCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMjIsMjMsIiIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFsyMywyNCwiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV1d
	\[\begin{tikzcd}
			{\mathcal{A}_0} && {\mathcal{A}_2} \\
			{\mathcal{M}_0} & {\mathcal{M}_1} & {\mathcal{M}_2} & {\mathcal{M}_3} & {\mathcal{M}_4} & \ldots & {\mathcal{M}=\bigcup_n \mathcal{M}_n} \\
			{\mathcal{A}_1} && {\mathcal{A}_3} \\
			{\mathcal{A}_1} & {\mathcal{B}_1} & {\mathcal{A}_3} & {\mathcal{B}_3} \\
			{\mathcal{A}_1} & {\mathcal{B}_1} & {\mathcal{A}_3} & {\mathcal{B}_3} \\
			\vdots & {\mathcal{B}_1} & \vdots & {\mathcal{B}_3} \\
			& \vdots && \vdots
			\arrow[dashed, from=2-1, to=2-2]
			\arrow[dashed, from=1-1, to=2-2]
			\arrow["{f_{1,1}}"{pos=0.1}, from=3-1, to=2-2]
			\arrow["{f_{1,2}}"{pos=0.1}, from=4-1, to=2-2]
			\arrow["{f_{1,3}}"{pos=0.1}, from=5-1, to=2-2]
			\arrow["{g_1}"{pos=0.7}, from=3-1, to=4-2]
			\arrow["{g_1}"{pos=0.7}, from=4-1, to=5-2]
			\arrow["{g_1}"{pos=0.7}, from=5-1, to=6-2]
			\arrow[dashed, from=4-2, to=2-3]
			\arrow[dashed, from=5-2, to=2-3]
			\arrow[dashed, from=6-2, to=2-3]
			\arrow[dashed, from=2-2, to=2-3]
			\arrow[dashed, from=2-3, to=2-4]
			\arrow[dashed, from=1-3, to=2-4]
			\arrow["{g_3}"{pos=0.7}, from=5-3, to=6-4]
			\arrow["{g_3}"{pos=0.7}, from=4-3, to=5-4]
			\arrow["{g_3}"{pos=0.7}, from=3-3, to=4-4]
			\arrow["{f_{2,1}}"{pos=0.1}, from=3-3, to=2-4]
			\arrow["{f_{2,2}}"{pos=0.1}, from=4-3, to=2-4]
			\arrow["{f_{2,3}}"{pos=0.1}, from=5-3, to=2-4]
			\arrow[dashed, from=4-4, to=2-5]
			\arrow[dashed, from=5-4, to=2-5]
			\arrow[dashed, from=6-4, to=2-5]
			\arrow[dashed, from=2-4, to=2-5]
			\arrow[dashed, from=2-5, to=2-6]
			\arrow[dashed, from=2-6, to=2-7]
		\end{tikzcd}\]
	where \(f_{1, i}\) are all \hyperref[def:embedding]{embeddings} \(\mathcal{A} _1 \hookrightarrow \mathcal{M} _1\), for example. Then as before, \(\Age(\mathcal{M} ) = \mathbb{K} \). To check \hyperref[def:EP]{extension property} w.r.t.\ \(\mathbb{K} \), we have
	% https://q.uiver.app/?q=WzAsMyxbMCwwLCJcXG1hdGhiYntLfVxcbmlcXG1hdGhjYWx7QX0iXSxbMSwwLCJcXG1hdGhjYWx7TX1fblxcc3Vic2V0ZXEgXFxtYXRoY2Fse019Il0sWzAsMSwiXFxtYXRoYmJ7S31cXG5pXFxtYXRoY2Fse0J9Il0sWzAsMSwiZiJdLFswLDJdXQ==
	\[\begin{tikzcd}
			{\mathbb{K}\ni\mathcal{A}} & {\mathcal{M}_n\subseteq \mathcal{M}} \\
			{\mathbb{K}\ni\mathcal{B}}
			\arrow["f", from=1-1, to=1-2]
			\arrow[from=1-1, to=2-1]
		\end{tikzcd}\]
	since each triple we listed are infinitely often, at some \(m \geq b\), \((\mathcal{A} _m, \mathcal{B} _m, g_m) = (\mathcal{A} , \mathcal{B} , g)\), so we just \hyperref[def:AP]{amalgamate} this into \(\mathcal{M} _{m+1}\).
\end{proof}

\begin{eg}
	Let \(\mathbb{K} \) be finite linear orders which has \hyperref[def:AP]{amalgamation property}:
	\begin{center}
		\incfig{linear-order-AP}
	\end{center}
\end{eg}

\begin{note}
	\(\mathbb{K} \) has the strong \hyperref[def:AP]{amalgamation property} (SAP) if it's always possible to \hyperref[def:AP]{amalgamate} such that \(\im(\widetilde{f} ) \cap \im(\widetilde{g} ) = \im (\widetilde{f} \circ f)\).\footnote{Recall that \(\widetilde{f} \circ f = \widetilde{g} \circ g\).}
	% https://q.uiver.app/?q=WzAsNCxbMSwwLCJcXG1hdGhjYWx7RH0iXSxbMiwxLCJcXG1hdGhjYWx7Q30iXSxbMSwyLCJcXG1hdGhjYWx7QX0iXSxbMCwxLCJcXG1hdGhjYWx7Qn0iXSxbMiwzLCJmIl0sWzIsMSwiZyIsMl0sWzEsMCwiXFx3aWRldGlsZGV7Z30iLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMywwLCJcXHdpZGV0aWxkZXtmfSIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
	\[\begin{tikzcd}
			& {\mathcal{D}} \\
			{\mathcal{B}} && {\mathcal{C}} \\
			& {\mathcal{A}}
			\arrow["f", from=3-2, to=2-1]
			\arrow["g"', from=3-2, to=2-3]
			\arrow["{\widetilde{g}}"', dashed, from=2-3, to=1-2]
			\arrow["{\widetilde{f}}", dashed, from=2-1, to=1-2]
		\end{tikzcd}\]
\end{note}
\begin{theorem}
	A \hyperref[def:Fraisse-limit]{Fraïssé limit} has \(\Age(\mathcal{M} )\) with SAP if and only if \(\mathcal{M} \) has trivial \(\acl\), i.e., \(\acl(A) = A\) for all \(A \subseteq M\).
\end{theorem}