\chapter{Ultraproducts}
\lecture{23}{30 Mar. 14:30}{Introduction to Ultraproducts}
\section{Ultrafilters}
\subsection{Filters}
\begin{definition}[Filter]\label{def:filter}
	Let \(I\) be a non-empty set, and \(\mathcal{P} (I)\) be the power set of \(I\). A \emph{filter} \(D\) on \(I\) is a collection \(D \subseteq \mathcal{P} (I)\) such that
	\begin{enumerate}[(a)]
		\item \(I\in D\) and \(\varnothing \notin D\);
		\item if \(A, B\in D\), then \(A \cap B\in D\);
		\item if \(A\in D\), and \(B \supseteq A\), then \(B\in D\).
	\end{enumerate}
\end{definition}

\begin{intuition}
	We think of \(D\) as a collection of \emph{very large subsets}.
\end{intuition}

\begin{eg}[Principal filter]\label{eg:principal-filter}
	Let \(i\) be any set, \(a\in I\). Then \(D_a = \{A \subseteq I \mid a\in A\}\) is the \emph{principal filter} generated by \(a\).
\end{eg}

\begin{eg}[Frechet filter]\label{eg:Frechet-filter}
	Let \(I\) be any infinite set, and let \(D\) be the collection of all \hyperref[def:cofinite]{cofinite} subsets of \(I\). This is the \emph{Frechet filter}.

	In particular, \(D\) is not \hyperref[eg:principal-filter]{principal}, and any \hyperref[def:filter]{filter} \(D^{\prime} \supseteq D\) is not \hyperref[eg:principal-filter]{principal} because for \(a\in I\), \(I - \{a\} \in D \subseteq D^{\prime} \), so if \(\{a\} \in D^{\prime} \), then
	\[
		\varnothing = \{a\} \cap (I - \{a\}) \in D^{\prime} .
	\]
	So \(\{a\} \notin D^{\prime} \).
\end{eg}

\begin{eg}[Extend]\label{eg:extend}
	If \(D\) is a \hyperref[def:filter]{filter} on \(I\), and \(X \subseteq I\) has \(X \notin D\), then we can extend \(D\) to a \hyperref[def:filter]{filter} \(E \supseteq D\) containing \(I - X\), namely
	\[
		E = \left\{ Y \subseteq I \mid Z-X\subseteq Y \text{ for some \(Z\in D\)} \right\}.
	\]
\end{eg}

\subsection{Ultrafilters}
\begin{definition}[Ultrafilter]\label{def:ultrafilter}
	A \hyperref[def:filter]{filter} \(D\) on \(I\) is called an \emph{ultrafilter}, if for all \(X \subseteq I\), either \(X\in D\) or \(I - X \in D\).
\end{definition}

\begin{note}
	It can't be both as \(X \cap (I - X) = \varnothing \notin D\).
\end{note}

\begin{intuition}
	One way to think of an \hyperref[def:ultrafilter]{ultrafilter} is a finitely additive \(\{0, 1\}\)-valued measure on \(\mathcal{P} (I)\).
\end{intuition}

\begin{eg}
	The \hyperref[eg:principal-filter]{principal filters} are (not very interesting) \hyperref[def:ultrafilter]{ultrafilters}.
\end{eg}

\begin{eg}
	If \(D\) is the \hyperref[eg:Frechet-filter]{Frechet filter}, then \(\mathcal{U} \) is non-\hyperref[eg:principal-filter]{principal}.
\end{eg}

\begin{theorem}
	Let \(D\) be a \hyperref[def:filter]{filter} on \(I\), then there is \(\mathcal{U} \) an \hyperref[def:ultrafilter]{ultrafilter} on \(I\) extending \(D\).
\end{theorem}
\begin{proof}
	Use \hyperref[thm:Zorn]{Zorn's lemma}. An \hyperref[def:ultrafilter]{ultrafilter} will be a \hyperref[def:POS-maximal]{maximal} \hyperref[def:filter]{filter}. Let \(P = \left\{ \text{\(E\) \hyperref[def:filter]{filter} on \(I\)} \mid E \supseteq D \right\} \), and we order \(P\) by inclusion.

	Consider a non-empty \hyperref[def:chain]{chain} \(C\) of \hyperref[def:filter]{filters} \(E \supseteq D\), then \(D^{\ast} = \bigcup_{E \in C} E\) is a \hyperref[def:filter]{filter} extending \(D\).\footnote{\(D^{\ast} \supseteq D\) since \(E \in C\) did. \(D^{\ast} \) is a \hyperref[def:filter]{filter} since if \(A, B\in D^{\ast} \), then there is \(E\in C\), \(A, B\in E\), so \(A \cap B \in E \subseteq D^{\ast} \).} \(D^{\ast} \) is then an \hyperref[def:upper-bound]{upper bound} for \(C\), so \hyperref[thm:Zorn]{Zorn's lemma} applies. Let \(\mathcal{U} \) be a \hyperref[def:POS-maximal]{maximal} element of \(\mathcal{P} \), and we argue that \(\mathcal{U} \) is an \hyperref[def:ultrafilter]{ultrafilter} extending \(D\).

	Suppose \(\mathcal{U} \) is not an \hyperref[def:ultrafilter]{ultrafilter}, so there is \(X \subseteq I\) such that \(X \notin \mathcal{U} \), \(I- X\notin \mathcal{U} \). From the \hyperref[eg:extend]{extending example}, we know that there is \(\mathcal{U} ^{\prime} \supseteq \mathcal{U} \) a \hyperref[def:filter]{filter} containing \(I - X\), contradicting the \hyperref[def:POS-maximal]{maximality} of \(\mathcal{U} \), so \(\mathcal{U} \) is an \hyperref[def:ultrafilter]{ultrafilter}.
\end{proof}

\begin{intuition}
	Think of an \hyperref[def:ultrafilter]{ultrafilter} is sort of ``voting''. Then the Arrow's impossibility theorem doesn't apply here since we may have infinitely number of voters.
\end{intuition}

\begin{remark}
	An \hyperref[def:ultrafilter]{ultrafilter} on a finite set is \hyperref[eg:principal-filter]{principal}.
\end{remark}
\begin{explanation}
	Let \(I = \left\{ a_1, \dots , a_n \right\} \), and \(\mathcal{U} \) be an \hyperref[def:ultrafilter]{ultrafilter}. For each \(a_i\), either \(\{a_i\} \in \mathcal{U} \) or \(I - \{a_i\} \in \mathcal{U} \).
	\begin{itemize}
		\item If we're in the first case for any \(i\), then \(\mathcal{U} \) is \hyperref[eg:principal-filter]{principal}.
		\item Otherwise, \((I - \{a_1\}) \cap (I-\{a_2\}) \cap \dots \cap (I-\{a_n\}) = \varnothing \in \mathcal{U} \), a contradiction.
	\end{itemize}
\end{explanation}

The above proof shows more.

\begin{remark}
	If \(\mathcal{U} \) is a non-\hyperref[eg:principal-filter]{principal} \hyperref[def:ultrafilter]{ultrafilter} on \(I\), \(\mathcal{U} \) extends the \hyperref[eg:Frechet-filter]{Frechet filter}.
\end{remark}

\section{Ultraproducts}

\begin{definition}[Ultraproduct]\label{def:ultraproduct}
	Let \(\mathcal{U} \) be an \hyperref[def:ultrafilter]{ultrafilter} on \(I\). For each \(i\in I\), let \(\mathcal{M} _i\) be an \hyperref[def:structure]{\(\mathcal{L} \)-structure}. We define an \hyperref[def:structure]{\(\mathcal{L} \)-structure} \(\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U}} \) called the \emph{ultraproduct} of the \(\mathcal{M} _i\) as follows.

	Let \(\prod_{i\in I} M_i\) be the tuples \((a_i)_{i\in I}\)\footnote{Sometimes it's easier to think of \((a_i)\) as a function \(a(i)\) from \(I\) to \(\bigcup M_i\) with \(a(i)\in M_i\).} Define an equivalence relation \(\sim \) or \(\sim _{\mathcal{U} }\) on \(\prod_{i\in I} M_i\) by \((a_i)_{i\in I} \sim (b_i)_{i\in I}\) if \(\{i\in I \mid a_i = b_i\}\in \mathcal{U} \). The domain will be \(\prod_{i\in I} \quotient{M_i}{\sim } \), the equivalence classes mod \(\sim _\mathcal{U} \).
	\begin{enumerate}[(a)]
		\item For each constant \(c\in \mathcal{L} \),
		      \[
			      c^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } } = \quotient{(c^{\mathcal{M} _i})_{i\in I}}{\sim } = [(c^{\mathcal{M} _i})].
		      \]
		\item For each function symbol \(f\in \mathcal{L} \) of arty \(n\), and \([(a_i^1)], \dots , [(a_i^1)] \in \prod_{i\in I} \quotient{\mathcal{M} _i}{\sim } \),
		      \[
			      f^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } } ([(a^1_i)], \dots , [(a^n_i)]) = \quotient{\left( f^{\mathcal{M} _i} (a_i^1, \dots , a_i^n) \right) _{i\in I}}{\sim } = [(f^{\mathcal{M} } (a^1, \dots , a^n))].
		      \]
		\item For each relation symbol \(R\in \mathcal{L} \) of arty \(n\), and \([(a_i^1)], \dots , [(a_i^n)]\),
		      \[
			      R^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } } \ni ([(a_i^1)], \dots , [(a_i^n)])
			      \iff \left\{ i \mid R^{\mathcal{M} _i} (a_i^1, \dots , a_i^n) \right\} \in \mathcal{U} .
		      \]
	\end{enumerate}
\end{definition}

\begin{note}
	\(\sim \) (or \(\sim _\mathcal{U} \)) is indeed an equivalence relation.
\end{note}
\begin{explanation}
	We see that \(\{i \mid a_i = b_i\} \cap \{i \mid b_i = c_i\} \subseteq \{i \mid a_i = c_i\}\), and from the definition of \hyperref[def:ultrafilter]{ultrafilter}, if the left-hand side in \(\mathcal{U} \), then the right-hand side is in \(\mathcal{U} \) as well, i.e., we have transitivity.
\end{explanation}

\begin{note}
	\(f^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } }\) is well-defined.
\end{note}
\begin{explanation}
	Let \((b_i^1) \sim (a_i^1), \dots , (b_i^n) \sim (a_i^n)\). There are \(X_1 = \{i \mid a_i^1 = b_i^1\} \in \mathcal{U} , \dots , X_n = \{i \mid a_i^n = b_i^n\}\in \mathcal{U} \). Then \(X = X_1 \cap \dots \cap X_n \in \mathcal{U} \). For \(i\in X\), \(f^{\mathcal{M} _i}(a_i^1, \dots , a_i^n) = f^{\mathcal{M} _i}(b_i^1, \dots , b_i^n)\), so \([(f^{\mathcal{M} _i}(a_i^1, , a_i^n))_{i\in I}] = [(f^{\mathcal{M} _i}(b_i^1, , b_i^n))_{i\in I}]\), hence \(f^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } }\) is well-defined.
\end{explanation}

\begin{note}
	\(R^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } }\) is well-defined.
\end{note}