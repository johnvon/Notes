\chapter{Ultrapowers}
\lecture{23}{30 Mar. 14:30}{Introduction to Ultraproducts}
\section{Ultrafilters}
\subsection{Filters}
\begin{definition}[Filter]\label{def:filter}
	Let \(I\) be a non-empty set, and \(\mathcal{P} (I)\) be the power set of \(I\). A \emph{filter} \(D\) on \(I\) is a collection \(D \subseteq \mathcal{P} (I)\) such that
	\begin{enumerate}[(a)]
		\item \(I\in D\) and \(\varnothing \notin D\);
		\item if \(A, B\in D\), then \(A \cap B\in D\);
		\item if \(A\in D\), and \(B \supseteq A\), then \(B\in D\).
	\end{enumerate}
\end{definition}

\begin{intuition}
	Think of \(D\) as a collection of \emph{very large subsets}, i.e., the set containing everything is large:
	\begin{enumerate}[(a)]
		\item the empty set is not big;
		\item anything bigger than a large set is large;
		\item the intersection of two large sets is still large.
	\end{enumerate}
\end{intuition}

The most important examples of \hyperref[def:filter]{filters} are the following.

\begin{eg}[Principal filter]\label{eg:principal-filter}
	Let \(I\) be any set, \(a\in I\). Then \(D_a = \{A \subseteq I \mid a\in A\}\) is the \emph{principal filter} generated by \(a\). It says that the large sets are exactly those containing \(a\).
\end{eg}

\begin{eg}[Frechet filter]\label{eg:Frechet-filter}
	Let \(I\) be any infinite set, and let \(D\) be the collection of all \hyperref[def:cofinite]{cofinite} subsets of \(I\). This is the \emph{Frechet filter}.
\end{eg}

In particular, a \hyperref[eg:Frechet-filter]{Frechet filter} \(D\) is not \hyperref[eg:principal-filter]{principal}, and any \hyperref[def:filter]{filter} \(D^{\prime} \supseteq D\) is not \hyperref[eg:principal-filter]{principal} because for \(a\in I\), \(I - \{a\} \in D \subseteq D^{\prime} \), so if \(\{a\} \in D^{\prime} \), then \(\varnothing = \{a\} \cap (I - \{a\}) \in D^{\prime} \conta\) so \(\{a\} \notin D^{\prime} \).

\begin{eg}[Extend]\label{eg:extend}
	If \(D\) is a \hyperref[def:filter]{filter} on \(I\), and \(X \subseteq I\) has \(X \notin D\), then we can \emph{extend} \(D\) to a \hyperref[def:filter]{filter} \(E \supseteq D\) containing \(I - X\), namely \(E = \left\{ Y \subseteq I \mid Z-X\subseteq Y \text{ for some \(Z\in D\)} \right\}\).
\end{eg}

\subsection{Ultrafilters}
Consider the following.

\begin{definition}[Ultrafilter]\label{def:ultrafilter}
	A \hyperref[def:filter]{filter} \(D\) on \(I\) is an \emph{ultrafilter} if for all \(X \subseteq I\), either \(X\in D\) or \(I - X \in D\).
\end{definition}

\begin{note}
	It can't be both as \(X \cap (I - X) = \varnothing \notin D\).
\end{note}

\begin{intuition}
	One way to think of an \hyperref[def:ultrafilter]{ultrafilter} is a finitely additive \(\{0, 1\}\)-valued measure on \(\mathcal{P} (I)\).\footnote{I.e., it takes only the values \(0\) on sets not in the \hyperref[def:ultrafilter]{ultrafilter}, and \(1\) otherwise.}
\end{intuition}

\begin{eg}
	The \hyperref[eg:principal-filter]{principal filters} are (not very interesting) \hyperref[def:ultrafilter]{ultrafilters}.
\end{eg}

To see that there are interesting \hyperref[def:ultrafilter]{ultrafilters}, we show that we can \hyperref[eg:extend]{extend} any \hyperref[def:filter]{filter} to an \hyperref[def:ultrafilter]{ultrafilter}; and in particular, if we \hyperref[eg:extend]{extend} the \hyperref[eg:Frechet-filter]{Frechet filter}, we will get a non-\hyperref[eg:principal-filter]{principal} \hyperref[def:ultrafilter]{ultrafilter}.

\begin{theorem}
	Let \(D\) be a \hyperref[def:filter]{filter} on \(I\), then there is \(\mathcal{U} \) an \hyperref[def:ultrafilter]{ultrafilter} on \(I\) extending \(D\).
\end{theorem}
\begin{proof}
	Use \hyperref[thm:Zorn]{Zorn's lemma}. An \hyperref[def:ultrafilter]{ultrafilter} will be a \hyperref[def:POS-maximal]{maximal} \hyperref[def:filter]{filter}. Let \(P = \left\{ \text{\(E\) \hyperref[def:filter]{filter} on \(I\)} \mid E \supseteq D \right\} \), and we order \(P\) by inclusion.

	Consider a non-empty \hyperref[def:chain]{chain} \(C\) of \hyperref[def:filter]{filters} \(E \supseteq D\), then \(D^{\ast} = \bigcup_{E \in C} E\) is a \hyperref[def:filter]{filter} extending \(D\).\footnote{\(D^{\ast} \supseteq D\) since \(E \in C\) did. \(D^{\ast} \) is a \hyperref[def:filter]{filter} since if \(A, B\in D^{\ast} \), then there is \(E\in C\), \(A, B\in E\), so \(A \cap B \in E \subseteq D^{\ast} \).} \(D^{\ast} \) is then an \hyperref[def:upper-bound]{upper bound} for \(C\), so \hyperref[thm:Zorn]{Zorn's lemma} applies. Let \(\mathcal{U} \) be a \hyperref[def:POS-maximal]{maximal} element of \(\mathcal{P} \), and we argue that \(\mathcal{U} \) is an \hyperref[def:ultrafilter]{ultrafilter} extending \(D\).

	Suppose \(\mathcal{U} \) is not an \hyperref[def:ultrafilter]{ultrafilter}, so there is \(X \subseteq I\) such that \(X \notin \mathcal{U} \), \(I- X\notin \mathcal{U} \). From the \hyperref[eg:extend]{extending example}, we know that there is \(\mathcal{U} ^{\prime} \supseteq \mathcal{U} \) a \hyperref[def:filter]{filter} containing \(I - X\), contradicting the \hyperref[def:POS-maximal]{maximality} of \(\mathcal{U} \), so \(\mathcal{U} \) is an \hyperref[def:ultrafilter]{ultrafilter}.
\end{proof}

\begin{intuition}
	Think of an \hyperref[def:ultrafilter]{ultrafilter} is a sort of ``voting'': the set \(I\) as a set of voters, and a set \(X \subseteq I\) of voters says ``yes'', then ``yes'' wins if \(X\) is in the \hyperref[def:ultrafilter]{ultrafilter}; and if \(I - X\) is in the \hyperref[def:ultrafilter]{ultrafilter} instead, then ``no'' wins.\footnote{The ``ultra'' part of the \hyperref[def:ultrafilter]{ultrafilter} means that either ``yes'' or ``no'' will always win.} The closure of the \hyperref[def:ultrafilter]{ultrafilter} under intersections is a very strong property which fails for elections with finitely many voters.
\end{intuition}

\begin{remark}
	An \hyperref[def:ultrafilter]{ultrafilter} on a finite set is \hyperref[eg:principal-filter]{principal}.
\end{remark}
\begin{explanation}
	Let \(I = \left\{ a_1, \dots , a_n \right\} \), and \(\mathcal{U} \) be an \hyperref[def:ultrafilter]{ultrafilter}. For each \(a_i\), either \(\{a_i\} \in \mathcal{U} \) or \(I - \{a_i\} \in \mathcal{U} \).
	\begin{itemize}
		\item If we're in the first case for any \(i\), then \(\mathcal{U} \) is \hyperref[eg:principal-filter]{principal}.
		\item Otherwise, \((I - \{a_1\}) \cap (I-\{a_2\}) \cap \dots \cap (I-\{a_n\}) = \varnothing \in \mathcal{U} \), a contradiction.
	\end{itemize}
\end{explanation}

The above proof shows more.

\begin{remark}
	If \(\mathcal{U} \) is a non-\hyperref[eg:principal-filter]{principal} \hyperref[def:ultrafilter]{ultrafilter} on \(I\), \(\mathcal{U} \) extends the \hyperref[eg:Frechet-filter]{Frechet filter}.
\end{remark}

Ultimately, with the voting analogy, it's possible that (with finitely many voters) a majority of the voters prefer ice cream to cake, and that a majority of the voters prefer ice cream to candy, but that only a minority of voters prefer ice cream to both cake and candy.

\begin{note}
	This is called the Condorcet paradox of voting,\footnote{Take SI652 to learn more!} and is related to \href{https://en.wikipedia.org/wiki/Arrow's_impossibility_theorem}{Arrow's impossibility theorem}. One proof of which is to show that any ``good'' method of voting must be an \hyperref[def:ultrafilter]{ultrafilter}, and that any \hyperref[def:ultrafilter]{ultrafilter} on a finite set is \hyperref[eg:principal-filter]{principal}, i.e, we must have a dictator.
\end{note}

\section{Ultraproducts}
We use this voting analogy to construct new \hyperref[def:model]{models} called \hyperref[def:ultraproduct]{ultraproducts}.

\begin{definition}[Ultraproduct]\label{def:ultraproduct}
	Let \(\mathcal{U} \) be an \hyperref[def:ultrafilter]{ultrafilter} on \(I\) and for each \(i\in I\), let \(\mathcal{M} _i\) be an \hyperref[def:structure]{\(\mathcal{L} \)-structure}. The \emph{ultraproduct} of the \(\mathcal{M} _i\)'s is an \hyperref[def:structure]{\(\mathcal{L} \)-structure} \(\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U}} \) defined as follows.

	Let \(\prod_{i\in I} M_i\) be the tuples \((a_i)_{i\in I}\) indexed by \(i\),\footnote{Sometimes it's easier to think of \((a_i)\) as a function \(a(i)\) from \(I\) to \(\bigcup M_i\) with \(a(i)\in M_i\).} and define an equivalence relation \(\sim \) (or \(\sim _{\mathcal{U} }\)) on \(\prod_{i\in I} M_i\) by \((a_i)_{i\in I} \sim (b_i)_{i\in I}\) if \(\{i\in I \mid a_i = b_i\}\in \mathcal{U} \). Then, the domain of \(\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U}} \) will be \(\prod_{i\in I} \quotient{M_i}{\sim } \), the equivalence classes mod \(\sim _\mathcal{U} \).
	\begin{enumerate}[(a)]
		\item For each constant \(c\in \mathcal{L} \),
		      \[
			      c^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } }
			      = \quotient{(c^{\mathcal{M} _i})_{i\in I}}{\sim }
			      \eqqcolon [(c^{\mathcal{M} _i})_{i\in I}].
		      \]
		\item For each function symbol \(f\in \mathcal{L} \) of arty \(n\), and \([(a_i^1)], \dots , [(a_i^n)] \in \prod_{i\in I} \quotient{\mathcal{M} _i}{\sim } \),
		      \[
			      f^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } } ([(a^1_i)], \dots , [(a^n_i)])
			      = \quotient{\left( f^{\mathcal{M} _i} (a_i^1, \dots , a_i^n) \right) _{i\in I}}{\sim }
			      \eqqcolon [(f^{\mathcal{M} _i} (a^1_i, \dots , a^n_i))_{i\in I}].
		      \]
		\item For each relation symbol \(R\in \mathcal{L} \) of arty \(n\), and \([(a_i^1)], \dots , [(a_i^n)]\),
		      \[
			      R^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } } \ni ([(a_i^1)], \dots , [(a_i^n)])
			      \iff \left\{ i \mid R^{\mathcal{M} _i} (a_i^1, \dots , a_i^n) \right\} \in \mathcal{U} .
		      \]
	\end{enumerate}
\end{definition}

\begin{intuition}
	Think of the \(\mathcal{M} _i\) as voting on what happens in the \hyperref[def:ultraproduct]{ultraproduct}.
\end{intuition}

There are a number of things that one must check to see that \autoref{def:ultraproduct} makes sense.

\begin{claim}
	\(\sim \) (or \(\sim _\mathcal{U} \)) is indeed an equivalence relation.
\end{claim}
\begin{explanation}
	The only thing that is nontrivial is the transitivity. Since \(\{i \mid a_i = b_i\} \cap \{i \mid b_i = c_i\} \subseteq \{i \mid a_i = c_i\}\), so from the definition of \hyperref[def:ultrafilter]{ultrafilter}, if the left-hand side in \(\mathcal{U} \) (\((a_i) \sim (b_i)\) and \((b_i) \sim (c_i)\)), then the right-hand side is in \(\mathcal{U} \) as well (\((a_i) \sim (c_i)\)), i.e., we have transitivity.
\end{explanation}

\begin{claim}
	\(f^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } }\) is well-defined.
\end{claim}
\begin{explanation}
	Let \((a_i^1) \sim (b_i^1), \dots , (a_i^n) \sim (b_i^n)\), i.e., \(X_j = \{i \in I \mid a_i^j = b_i^j\} \in \mathcal{U}\). Then \(X = X_1 \cap \dots \cap X_n \in \mathcal{U} \). Thus, for \(i\in X\), \(f^{\mathcal{M} _i}(a_i^1, \dots , a_i^n) = f^{\mathcal{M} _i}(b_i^1, \dots , b_i^n)\), hence
	\[
		[(f^{\mathcal{M} _i}(a_i^1, \dots , a_i^n))_{i\in I}] = [(f^{\mathcal{M} _i}(b_i^1, \dots , b_i^n))_{i\in I}],
	\]
	i.e., \(f^{\prod_{i\in I}^{} \quotient{\mathcal{M} _i}{\mathcal{U} } }\) is well-defined.
\end{explanation}

\begin{note}
	\(R^{\prod_{i\in I} \quotient{\mathcal{M} _i}{\mathcal{U} } }\) is well-defined.
\end{note}